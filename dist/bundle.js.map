{"version":3,"sources":["webpack:///webpack/bootstrap c37ce223e600ee2dd7d7","webpack:///./utils/index.js","webpack:///./enum/index.js","webpack:///./model/Brick.js","webpack:///./model/Game.js","webpack:///./index.js","webpack:///./data/index.js","webpack:///./data/shapes.js","webpack:///./enum/gameType.js","webpack:///./enum/pointType.js","webpack:///./utils/deepCopy.js","webpack:///./utils/lineIndex.js","webpack:///./utils/matrixString.js","webpack:///./utils/rotateArray.js","webpack:///./view/RenderCanvas.js","webpack:///./view/index.js","webpack:///./enum/buildEnum.js","webpack:///./data/getShape.js"],"names":["default","deafultColors","Brick","configs","shape","color","Math","random","length","Game","width","height","oldBrickColor","backColor","status","start","oldMatrix","Array","fill","map","_","empty","matrix","brick","position","over","nextPosition","running","blend","getShape","x","y","some","arr","row","item","col","matrixRow","updateMatrix","setup","forEach","pos","firstRow","brickWidth","rowIndex","_pos","topLine","deep","min","apply","colIndex","newBlend","newFirstRow","rangeLen","bottomDetection","blIndex","blPos","index","result","oldBrick","mergeBrick","unloadBrick","removeFullLine","yPos","xPos","oldMatrixRow","fullLineCount","every","newBrick","concat","filter","free","console","clear","log","join","game","renderCanvas","document","getElementById","init","loadBrick","render","window","addEventListener","e","arrow","move","keyCode","refreshMatrix","interval","setInterval","clearInterval","querySelectorAll","type","target","dataset","includes","shapes","rotate1","rotate2","rotate3","module","exports","obj","arg","cache","bottom","key","filterIndex","getIndex","reverse","rowLen","colLen","newArg","RenderCanvas","canvas","context","getContext","backCanvas","cloneNode","offsetTop","offsetLeft","setAttribute","getAttribute","parentElement","appendChild","style","top","left","zIndex","backContext","brickCanvas","brickContext","firstLine","renderBack","cellWidth","cellHeight","brickColor","backPoints","Number","sameBack","lastBackPoints","cleanBack","cleanBrick","fillStyle","fillRect","newObj","Object","entries","assign","value","len"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"./dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 17);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap c37ce223e600ee2dd7d7","export { default as deepCopy } from './deepCopy'\nexport { default as lineIndex } from './lineIndex'\nexport { default as rotateArray } from './rotateArray'\nexport { default as matrixString } from './matrixString'\n\n\n\n// WEBPACK FOOTER //\n// ./utils/index.js","export { default as gameType } from './gameType'\nexport { default as pointType } from './pointType'\n\n\n\n// WEBPACK FOOTER //\n// ./enum/index.js","// @flow\nimport { rotateArray } from '../utils'\n\nconst deafultColors = [\n  '#ffc107',\n  '#2196f3',\n  '#673ab7',\n  '#f44336',\n  '#009688',\n  '#ffeb3b'\n]\n\n// 方块\nexport default class Brick {\n  shape: matrix\n  color: string\n\n  constructor(configs: { shape: matrix, color?: string }) {\n    this.shape = configs.shape\n    this.color =\n      configs.color || deafultColors[(Math.random() * deafultColors.length) | 0]\n  }\n\n  // 获取方块的位置信息\n  getShape(): matrix {\n    return this.shape\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./model/Brick.js","// @flow\n\nimport Brick from './Brick'\nimport { deepCopy, lineIndex, rotateArray } from '../utils'\nimport { pointType, gameType } from '../enum'\n\n// 游戏的核心控制\n// 用来进行方块数据的移动\nexport default class Game {\n  width: number\n  height: number\n  status: number\n  position: pos | null\n  nextPosition: pos | null\n  brick: Brick | null\n  matrix: matrix\n  oldMatrix: matrix\n  blend: matrix | null\n  oldBrickColor: string\n  backColor: string\n\n  constructor(\n    configs: Object = {\n      width: 8,\n      height: 20,\n      oldBrickColor: '#4caf50',\n      backColor: '#9e9e9e'\n    }\n  ) {\n    this.width = configs.width\n    this.height = configs.height\n    this.oldBrickColor = configs.oldBrickColor\n    this.backColor = configs.backColor\n  }\n\n  init() {\n    this.status = gameType.start\n\n    this.oldMatrix = new Array(this.height)\n      .fill(0)\n      .map((_: number): arr => new Array(this.width).fill(pointType.empty))\n\n    // test\n    // this.oldMatrix.map((row, rowIndex) => {\n    //   row[6] = pointType.oldBrick\n    // })\n    // test end\n    this.matrix = deepCopy(this.oldMatrix)\n  }\n\n  loadBrick(brick: Brick, position: pos) {\n    let { matrix, status } = this\n\n    if (status === gameType.over) return\n\n    this.brick = brick\n    this.nextPosition = position\n    this.status = gameType.running\n\n    let blend = (this.blend = brick.getShape())\n    let [x, y] = position\n\n    // can not put\n    if (\n      blend.some(\n        (arr: arr, row: number): boolean =>\n          !!arr &&\n          arr.some((item: number, col: number): boolean => {\n            let matrixRow = matrix[row + y]\n            return !!(item && matrixRow && matrixRow[col + x])\n          })\n      )\n    ) {\n      this.status = gameType.over\n      return\n    }\n\n    this.updateMatrix()\n  }\n\n  // 更新当前brick的位置\n  updateMatrix() {\n    let { oldMatrix, nextPosition, status } = this\n\n    if (status === gameType.over) return\n\n    this.matrix = deepCopy(oldMatrix)\n    this.position = nextPosition\n\n    this.setup()\n  }\n\n  // 将当前活动的方块装载到矩阵中\n  setup() {\n    let { matrix, position, blend } = this\n\n    if (!blend || !position) return\n\n    let [x, y] = position\n\n    // put brick\n    blend.forEach(\n      (arr: arr, row: number) =>\n        arr &&\n        arr.forEach((item: number, col: number) => {\n          let matrixRow = matrix[row + y]\n          if (item && matrixRow) {\n            matrixRow[col + x] = item\n          }\n        })\n    )\n  }\n\n  // 进行移动的操作\n  move(pos: 'down' | 'left' | 'right' | 'bottom') {\n    let {\n      position,\n      brick,\n      height,\n      width,\n      matrix,\n      oldMatrix,\n      blend,\n      status\n    } = this\n\n    if (!position || !brick || !blend || status === gameType.over) return\n\n    let firstRow = blend[0]\n\n    if (!firstRow) return\n\n    let brickWidth = firstRow.length\n\n    let [x, y] = position\n    this.nextPosition = null\n    switch (pos) {\n      case 'down': // 自然下降\n        this.nextPosition = [x, y + 1]\n        break\n      case 'left': // 左移\n        if (\n          x <= 0 ||\n          blend.some((row, rowIndex) => {\n            let _pos = oldMatrix[y + rowIndex]\n            return row && row[0] && _pos && _pos[x - 1]\n          })\n        )\n          return // 左侧有障碍物，无法移动\n        this.nextPosition = [x - 1, y]\n        break\n      case 'right': // 右移\n        if (\n          x >= width - brickWidth ||\n          blend.some((row, rowIndex) => {\n            let _pos = oldMatrix[y + rowIndex]\n            return row && row[brickWidth - 1] && _pos && _pos[x + brickWidth]\n          })\n        )\n          return // 右侧有障碍物，无法移动\n        this.nextPosition = [x + 1, y]\n        break\n      case 'bottom': // 下降到底部\n        let topLine = lineIndex(this.oldMatrix, false)\n        let deep = Math.min.apply(\n          Math,\n          lineIndex(this.blend, true).map((deep, colIndex) => {\n            return topLine[x + colIndex] - deep\n          })\n        ) // 获取最多可以下降到的坐标\n        this.nextPosition = [x, deep]\n        break\n      case 'rotate': // 旋转\n        let newBlend = rotateArray(this.blend)\n\n        let newFirstRow = newBlend[0]\n\n        let rangeLen = newFirstRow ? newFirstRow.length + x - width : 0\n\n        if (\n          newBlend.some((row, rowIndex) => {\n            let _pos = oldMatrix[y + rowIndex]\n            return (\n              row &&\n              _pos &&\n              row.some((col, colIndex) => col && _pos[colIndex + x])\n            )\n          })\n        ) {\n          return // console.log('有障碍物')\n        } else if (rangeLen > 0) {\n          this.nextPosition = [x - rangeLen, y]\n        } else {\n          this.nextPosition = position\n        }\n\n        this.blend = newBlend\n        break\n      default:\n        // 其余情况不处理\n        return\n    }\n    this.updateMatrix()\n\n    this.bottomDetection()\n  }\n\n  // 触底检测\n  bottomDetection() {\n    let { matrix, position, status, blend, height } = this\n\n    if (!blend || !position || status === gameType.over) return\n\n    let [x, y] = position\n    let blIndex = lineIndex(blend, true) // 这里边获取的下标 + 当前方块的坐标，如果对应的在矩阵中有值，就说明触底了。\n\n    let blPos = blIndex.map((index, colIndex) => [x + colIndex, y + index])\n\n    let result = blPos.some(\n      ([col, row]) => row === height || matrix[row][col] === pointType.oldBrick\n    )\n\n    if (result) {\n      // merge brick\n      this.mergeBrick()\n\n      // unload brick\n      this.unloadBrick()\n\n      this.removeFullLine()\n    }\n  }\n\n  // 触底后进行合并，将之前的方块塞入背景中，移除方块的引用，等待新的方块\n  mergeBrick() {\n    let { matrix, oldMatrix, blend, position, status } = this\n\n    if (!position || !blend) return\n\n    let [x, y] = position\n\n    blend.forEach((row, rowIndex) => {\n      row &&\n        row.forEach((col, colIndex) => {\n          let yPos = rowIndex + y\n          let xPos = colIndex + x\n\n          let oldMatrixRow = this.oldMatrix[yPos]\n          let matrixRow = this.matrix[yPos]\n          if (col && oldMatrixRow && matrixRow) {\n            oldMatrixRow[xPos] = matrixRow[xPos] = pointType.oldBrick\n          }\n        })\n    })\n  }\n\n  // 移除整行的方块\n  removeFullLine() {\n    let { oldMatrix, width } = this\n\n    let fullLineCount = 0\n    oldMatrix.forEach((row, rowIndex) => {\n      if (\n        !!row &&\n        row.every(_ => _ === pointType.oldBrick || _ === pointType.newBrick)\n      ) {\n        oldMatrix[rowIndex] = null\n        fullLineCount++\n      }\n    })\n\n    // 如果有移除的行\n    if (fullLineCount) {\n      this.oldMatrix = new Array(fullLineCount)\n        .fill(0)\n        .map(_ => new Array(width).fill(pointType.empty))\n        .concat(oldMatrix.filter(_ => _))\n      this.updateMatrix()\n    }\n  }\n\n  // 卸载方块\n  unloadBrick() {\n    this.status = gameType.free\n    this.brick = null\n    this.blend = null\n    this.position = null\n    this.nextPosition = null\n  }\n\n  // 调试用的方法，也可以作为console版本游戏来看待\n  log() {\n    console.clear()\n    console.log(\n      this.matrix\n        .map((arr: arr): string => (arr ? arr.join('') : ''))\n        .join('\\n')\n    )\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./model/Game.js","// @flow\n\nimport Game from './model/Game'\nimport Brick from './model/Brick'\nimport { pointType, gameType } from './enum'\nimport { RenderCanvas } from './view'\nimport { getShape } from './data'\n\nlet game = new Game()\nlet renderCanvas = new RenderCanvas(document.getElementById('canvas'))\n\ngame.init()\nloadBrick()\nrenderCanvas.render(game)\n\nwindow.addEventListener('keyup', function(e: KeyboardEvent) {\n  if (game.status === gameType.over) return\n  let arrow = {\n    '83': 'bottom',\n    '68': 'right',\n    '65': 'left',\n    '87': 'rotate'\n  }\n\n  game.move(arrow[e.keyCode])\n  renderCanvas.render(game)\n  if (game.status === gameType.free) {\n    refreshMatrix()\n  }\n})\n\nlet interval = setInterval(refreshMatrix, 500)\n\nfunction refreshMatrix() {\n  if (game.status === gameType.free) {\n    loadBrick()\n  } else if (game.status === gameType.over) {\n    clearInterval(interval)\n  } else {\n    game.move('down')\n  }\n  renderCanvas.render(game)\n}\n\nfunction loadBrick() {\n  let shape = getShape()\n  let brick = new Brick({\n    shape\n  })\n\n  game.loadBrick(brick, [(Math.random() * (8 - shape.length + 1)) | 0, 0])\n}\n\ndocument.querySelectorAll('.controller-btn').forEach(item => {\n  item.addEventListener('click', function(e: any) {\n    let { type } = e.target.dataset\n    if (['bottom', 'rotate', 'left', 'right'].includes(type)) {\n      game.move(type)\n      renderCanvas.render(game)\n    }\n  })\n})\n\n// test shape\n// [\n//   [\n//     pointType.newBrick,\n//     pointType.newBrick,\n//     pointType.newBrick,\n//     pointType.newBrick\n//   ]\n// ]\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","export { default as getShape } from './getShape'\n\n\n\n// WEBPACK FOOTER //\n// ./data/index.js","import { pointType } from '../enum'\nimport { rotateArray } from '../utils'\n\nlet { newBrick, empty } = pointType\n\nlet shapes = [\n  [[newBrick, newBrick, newBrick], [empty, empty, newBrick]],\n  [[newBrick, newBrick, newBrick, newBrick]],\n  [[newBrick, newBrick, newBrick], [empty, newBrick, empty]],\n  [[newBrick, newBrick], [newBrick, newBrick]]\n]\n\nshapes.forEach(item => {\n  let rotate1 = rotateArray(item)\n  let rotate2 = rotateArray(rotate1)\n  let rotate3 = rotateArray(rotate2)\n  shapes = shapes.concat([rotate1, rotate2, rotate3])\n})\n\nmodule.exports = shapes\n\n\n\n// WEBPACK FOOTER //\n// ./data/shapes.js","import buildEnum from './buildEnum'\n\nlet obj = {\n  start: 1,\n  over: 0,\n  free: 2, // 空闲状态，等待新方块的插入\n  running: 3 // 正常运行中\n}\n\nmodule.exports = buildEnum(obj)\n\n\n\n// WEBPACK FOOTER //\n// ./enum/gameType.js","import buildEnum from './buildEnum'\n\nlet obj = {\n  empty: 0,\n  newBrick: 1,\n  oldBrick: 2\n}\n\nmodule.exports = buildEnum(obj)\n\n\n\n// WEBPACK FOOTER //\n// ./enum/pointType.js","/**\n * 一个针对性很强的深拷贝\n * @param {matrix} arg\n */\nmodule.exports = function(arg: matrix): matrix {\n  return [...arg.map((row: arr): arr => [...row])]\n}\n\n\n\n// WEBPACK FOOTER //\n// ./utils/deepCopy.js","import { rotateArray, matrixString } from '.'\n\nlet cache = {} // 添加一个缓存对象\n\nmodule.exports = function(arg: matrix, bottom: boolean) {\n  let key = matrixString(arg)\n\n  if (cache[key]) return cache[key]\n\n  return (cache[key] = rotateArray(arg).map(filterIndex(bottom)))\n}\n\n/**\n * 获取每一列对应的下标\n * @param {boolean} bottom\n */\nfunction filterIndex(bottom: boolean) {\n  return function(row: arr): number {\n    let result = getIndex(bottom ? row : [].concat(row).reverse())\n    return bottom\n      ? result >= 0 ? row.length - result : result\n      : result === -1 ? row.length : result\n  }\n}\n\n/**\n * 获取当前下标，如果没有则返回-1\n * @param {martix} arr\n * @param {number} index\n */\nfunction getIndex(arr: arr, index: number = 0): number {\n  if (index >= arr.length) return -1\n\n  return arr[index] ? index : getIndex(arr, index + 1)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./utils/lineIndex.js","/**\n * 将一个矩阵转换为字符串，主要用来获取方块坐标信息的缓存使用\n * @param {matrix} arr\n */\nexport default function(arr: matrix): string {\n  return arr.map(row => row.join('')).join('|')\n}\n\n\n\n// WEBPACK FOOTER //\n// ./utils/matrixString.js","module.exports = function(arg: matrix): matrix {\n  let rowLen = arg.length\n  let colLen = arg[0].length\n\n  let newArg = new Array(colLen).fill(0).map(_ => new Array(rowLen).fill(0))\n\n  arg = [].concat(arg).reverse()\n\n  newArg.forEach((row, rowIndex) => {\n    row.forEach((_, col) => {\n      newArg[rowIndex][col] = arg[col][rowIndex]\n    })\n  })\n\n  return newArg\n}\n\n\n\n// WEBPACK FOOTER //\n// ./utils/rotateArray.js","// @flow\nimport { pointType } from '../enum'\nimport { matrixString } from '../utils'\nimport Game from '../model/Game'\n\nexport default class RenderCanvas {\n  canvas: HTMLCanvasElement\n  context: CanvasRenderingContext2D\n  backCanvas: HTMLCanvasElement\n  backContext: CanvasRenderingContext2D\n  brickCanvas: HTMLCanvasElement\n  brickContext: CanvasRenderingContext2D\n  width: number\n  height: number\n  lastBackPoints: string\n\n  constructor(canvas: HTMLCanvasElement) {\n    if (!canvas) return\n\n    this.canvas = canvas\n    this.context = canvas.getContext('2d')\n    this.width = canvas.width\n    this.height = canvas.height\n\n    // clone elements\n    let backCanvas = (this.backCanvas = canvas.cloneNode(true))\n    let { offsetTop, offsetLeft } = canvas\n    backCanvas.setAttribute(\n      'id',\n      (canvas.getAttribute('id') || '_canvas') + '_back'\n    )\n    canvas.parentElement && canvas.parentElement.appendChild(backCanvas)\n    backCanvas.style.position = 'absolute'\n    backCanvas.style.top = offsetTop + 'px'\n    backCanvas.style.left = offsetLeft + 'px'\n    backCanvas.style.zIndex = '2'\n    this.backContext = backCanvas.getContext('2d')\n\n    let brickCanvas = (this.brickCanvas = canvas.cloneNode(true))\n    brickCanvas.setAttribute(\n      'id',\n      (canvas.getAttribute('id') || '_canvas') + '_brick'\n    )\n    canvas.parentElement && canvas.parentElement.appendChild(brickCanvas)\n    brickCanvas.style.position = 'absolute'\n    brickCanvas.style.top = offsetTop + 'px'\n    brickCanvas.style.left = offsetLeft + 'px'\n    brickCanvas.style.zIndex = '3'\n    this.brickContext = brickCanvas.getContext('2d')\n  }\n\n  render(game: Game) {\n    let { matrix, brick, oldBrickColor, backColor } = game\n    let { width, height, context, backContext, brickContext } = this\n\n    if (!matrix) return\n\n    let firstLine = matrix[0]\n\n    if (!firstLine) return\n\n    this.renderBack(backColor)\n\n    let cellWidth = width / firstLine.length\n    let cellHeight = height / matrix.length\n    let { color: brickColor } = brick || {}\n\n    let backPoints = matrixString(\n      matrix.map(\n        row => row && row.map(col => Number(col === pointType.oldBrick))\n      )\n    )\n\n    let sameBack = this.lastBackPoints && backPoints === this.lastBackPoints\n\n    if (!sameBack) {\n      this.cleanBack()\n    }\n\n    this.cleanBrick()\n\n    // render brick\n    matrix.forEach((row, rowIndex) => {\n      row &&\n        row.forEach((col, colIndex) => {\n          switch (col) {\n            case pointType.newBrick:\n              brickContext.fillStyle = brickColor\n              brickContext.fillRect(\n                colIndex * cellWidth,\n                rowIndex * cellHeight,\n                cellWidth,\n                cellHeight\n              )\n              break\n            case pointType.oldBrick:\n              backContext.fillStyle = oldBrickColor\n\n              backContext.fillRect(\n                colIndex * cellWidth,\n                rowIndex * cellHeight,\n                cellWidth,\n                cellHeight\n              )\n              break\n            default:\n              return\n          }\n        })\n    })\n  }\n\n  renderBack(backColor: string = 'gray') {\n    let { context, width, height } = this\n\n    context.fillStyle = backColor\n    context.fillRect(0, 0, width, height)\n  }\n\n  cleanBrick() {\n    this.brickCanvas.width = this.brickCanvas.width\n  }\n\n  cleanBack() {\n    this.backCanvas.width = this.backCanvas.width\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./view/RenderCanvas.js","export { default as RenderCanvas } from './RenderCanvas'\n\n\n\n// WEBPACK FOOTER //\n// ./view/index.js","module.exports = function(obj) {\n  let newObj = {}\n\n  Object.entries(Object.assign(newObj, obj)).forEach(\n    ([value, key]) => (newObj[key] = value)\n  )\n\n  return newObj\n}\n\n\n\n// WEBPACK FOOTER //\n// ./enum/buildEnum.js","import shapes from './shapes'\n\nconst len = shapes.length\n\nexport default function() {\n  return shapes[(Math.random() * len) | 0]\n}\n\n\n\n// WEBPACK FOOTER //\n// ./data/getShape.js"],"sourceRoot":""}